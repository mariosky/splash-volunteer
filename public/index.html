

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Distributed Evolutionary Algorithm</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">


    <script type="text/javascript" src='js/Chart.min.js'></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  
<style>

body {
  padding-top: 20px;
  padding-bottom: 20px;
}

.worker_line
{
height: 150px;
padding-right: 10px;

}


</style>

  </head>
  <body>

<div class="container">
      <div class="header clearfix">
        <nav>
          <ul class="nav nav-pills pull-right">
            <li role="presentation" class="active"><a href="#">Home</a></li>

            <li role="presentation"><a href="/">Restart</a></li>
            <li role="presentation"><a href="https://github.com/mariosky/splash-volunteer/tree/IEEE-CIM">Fork in Github</a></li>
          </ul>
        </nav>
        <h3 class="text-muted">An experiment in distributed evolutionary computation 
          <span id='ips' class="label label-info">0 User(s) Collaborating</span> 
        </h3>
      </div>

  <h1 class="page-header">How are we doing? </h1> 
   <!---->
   <!-- WORKER 1-->
   <!---->
   <div class="row">

     <div class="col-md-12">
		 	<div class="panel panel-default">
  			<div class="panel-heading"> <i class="fa fa-cog"></i> Worker 1  <span id='w1_status' class="label label-info"> status </span> </div>
		  	<div class="panel-body">

             <div class="row">
      		    <div class="col-md-4">
                 <h4>Worker 1 information</h4> 
                <ul class="list-group">
                    <li class="list-group-item"> Population size <span  id="w1_pop" class="badge"></span> </li>
                    <li class="list-group-item"> Current generation  <span id="w1_gen" class="badge"></span> </li>
                    <li class="list-group-item"> Best fitness   <span id="w1_best" class="badge"></span> </li>
                    <li class="list-group-item"> Number of solutions found  <span id="w1_finished" class="badge"> 0 </span> </li>
                
                </ul>
              </div>

      				<div class="col-md-4">
                <h4>Fitness</h4>
      						<canvas id="fitness_w1" class="worker_line" ></canvas>
      				</div>
      				

              <div class="col-md-4">
                   <h4>Best Chromosome</h4>
                  <canvas id="chromosome_w1" class="worker_line" ></canvas>
              </div>


      		</div>
           <div class="row">
              <div class="col-md-2">
                <button type="button" class="btn btn-danger btn-sm" id="start_w1">Re-start</button>
              </div>
            </div>
      	</div>

		 </div>
	   </div>




   </div>
   <!---->
   <!-- WORKER 2-->
   <!---->
   <div class="row">
     <div class="col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading"> <i class="fa fa-cog"></i> Worker 2 <span id='w2_status' class="label label-info"> status </span></div>
        <div class="panel-body">
            <div class="row"> 
              <div class="col-md-4">
                 <h4>Worker 1 information</h4>
                <ul class="list-group">
                    <li class="list-group-item"> Population size <span id="w2_pop" class="badge"></span> </li>
                    <li class="list-group-item"> Current generation  <span id="w2_gen" class="badge"></span> </li>
                    <li class="list-group-item"> Best fitness  <span id="w2_best" class="badge"></span> </li>
                    <li class="list-group-item"> Number of solutions found  <span id="w2_finished" class="badge"> 0 </span> </li>
                
                </ul>
              </div>

              <div class="col-md-4">
                <h4>Fitness</h4>
                  <canvas id="fitness_w2" class="worker_line" ></canvas>
              </div>
              

              <div class="col-md-4">
                   <h4>Best Chromosome</h4>
                  <canvas id="chromosome_w2" class="worker_line" ></canvas>
              </div>


          </div>
            <div class="row">
              <div class="col-md-2">
                <button type="button" class="btn btn-danger btn-sm" id="start_w2">Re-start</button>
              </div>
            </div>

      </div>


     </div>
     </div>   
  </div>         
  



   <div class="row">
		 <div class="col-md-8">
		 	<div class="panel panel-default">
  			<div class="panel-heading"> <h4 id="population-w2"> About This </h4> </div>
		  	<div class="panel-body">
			    <p>This is an experiment in distributed evolutionary
				  computation where you're contributing by just visiting this
				    page. You can read about it
				  in <a href='http://arxiv.org/abs/1503.06424'>this
				      paper</a>. Your browser will be evaluating a population
				  of <em>chromosomes</em>, <em>mutating</em> and mixing them
				  to create a new population in
				  an <a href='https://en.wikipedia.org/wiki/Evolutionary_algorithm'>evolutionary
				      algorithm</a> that sends every <code>n</code>
				  generations the best chromosome to the server, receiving a
				  random one. Each row above represents a worker process showing the best chromosome so
				  far.</p>
                <h4> Benchmark Function </h4>
                <p>Our benchmark is based on the Rastrigin Function with 1000 Dimensions. Rastrigin function of two variables: </p>
                <img class="img-responsive  center-block"  src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/8b/Rastrigin_function.png/300px-Rastrigin_function.png" alt="Rastrigin"/>
                <p>And we also added a little more complexity: </p>

                <img class="img-responsive  center-block" src="https://s3.amazonaws.com/mariogarcia/images/f15.png" alt=""/>
                    <p>The algorithm is searching for the global minimum.
                        This will happen when a chromosome reaches zero.
                        Help us find it.
                        You can press Re-start in any moment to replace a worker with a new one.</p>
		  	</div>
	  </div>
		 </div>
  		<div class="col-md-4">

		  <div class="panel panel-default">
	  			<div class="panel-heading"> <h4><i class="fa fa-cog"> </i> Get the data</h4> </div>
			  	<div class="panel-body">
				    <p>Processed and raw data will
		  be <a href='https://github.com/mariosky/splash-volunteer/tree/data'>available
		      from GitHub</a>. Please
		  use <a href='https://github.com/mariosky/splash-volunteer/issues'>the
		  issues section for suggestions and questions, as well as
		      feature requests.</a></p> 
			  	</div>
		  </div>
	  	</div>
	</div>


	  


    <footer class="footer">
      <div class="container">

      	  <p  id="footer1" class='text-centered text-muted'>Grab the code and data in <a href='https://github.com/mariosky/splash-volunteer'>GitHub</a>. This is free software under the <a href='http://www.gnu.org/licenses/'>Affero GPL license</a>.</p>

            
      </div>
    </footer>

  </div>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
   <script>
  var worker_1;
  var worker_2;


  var config = {  
      populatiom_min:500,
      population_max:500,
      random_population:true,
      period :  100,
      population_size : 500

  }


    var fitness_w1 = document.getElementById('fitness_w1').getContext('2d');
    var chromosome_w1 = document.getElementById('chromosome_w1').getContext('2d');


    var fitness_w2 = document.getElementById('fitness_w2').getContext('2d');
    var chromosome_w2 = document.getElementById('chromosome_w2').getContext('2d');


    // Chart data
    fitness_data_w1 = {
        labels : [],
        datasets : [
            {
                fillColor : "rgba(172,194,132,0.4)",
                strokeColor : "#ACC26D",
                pointColor : "#fff",
                pointStrokeColor : "#9DB86D",
                data : []
            }
        ]
    }

    fitness_chart_w1 = new Chart(fitness_w1).Line( fitness_data_w1, {  responsive: false,  animation: false ,  maintainAspectRatio: true, bezierCurve: false});

    chromosome_data_w1 ={
        labels :  Array.apply(null, new Array(160)).map(String.prototype.valueOf,""),
        datasets : [
            {
                fillColor : "rgba(172,194,132,0.4)",
                strokeColor: "rgba(151,187,205,1)",
                pointColor : "#fff",
                pointStrokeColor : "#9DB86D",
                data : Array.apply(null, new Array(1000)).map(Number.prototype.valueOf,0)
            }
        ]
    }

    chromosome_chart_w1 = new Chart(chromosome_w1).Line(chromosome_data_w1,

                    {
                        bezierCurve: false, responsive: false, animation: false,pointDot : false,
                        datasetFill : false



                    });

      
      fitness_data_w2 = {
        labels : [],
        datasets : [
            {
                fillColor : "rgba(172,194,132,0.4)",
                strokeColor : "#ACC26D",
                pointColor : "#fff",
                pointStrokeColor : "#9DB86D",
                data : []
            }
        ]
    }

    fitness_chart_w2 = new Chart(fitness_w2).Line( fitness_data_w2, 
                {
                        responsive: false,  animation: false ,  maintainAspectRatio: true,bezierCurve: false

                    });

  chromosome_data_w2 ={
      labels :  Array.apply(null, new Array(160)).map(String.prototype.valueOf,""),
      datasets : [
          {
              fillColor : "rgba(172,194,132,0.4)",
              strokeColor: "rgba(151,187,205,1)",
              pointColor : "#fff",
              pointStrokeColor : "#9DB86D",
              data : Array.apply(null, new Array(1000)).map(Number.prototype.valueOf,0)
          }
      ]
  }

  chromosome_chart_w2 = new Chart(chromosome_w2).Line(chromosome_data_w2,

          {
              bezierCurve: false, responsive: false, animation: false,pointDot : false,
              datasetFill : false



          });





   $( document ).ready(function() {






     $("#start_w1").click(function () {
           // terminate_worker_1();
            setup_worker_1();
          });

     $("#start_w2").click(function () {
          //   terminate_worker_2();
            setup_worker_2();
          });

    setup_worker_1();
    setup_worker_2();




	});

  var set_population = function( config)
      {
        if (config.random_population)
        {
          pop_size=Math.floor( (Math.random() * (config.population_max-config.populatiom_min)) + config.populatiom_min); 
          //population has to be an even number?
          if (pop_size%2 == 1)
          {
              pop_size++;
          }
          config.population_size=pop_size;
        }

        return config;

      } 

  var terminate_workers = function()
  {
        if(typeof(Worker) !== "undefined") {
          if(typeof(worker_1) != "undefined") {
              worker_1.terminate();
          }
        }
        if(typeof(Worker) !== "undefined") {
          if(typeof(worker_2) != "undefined") {
              worker_2.terminate();
          }
        }

        document.getElementById('w1_status').textContent='Finished';
        document.getElementById('w2_status').textContent='Finished';
     
  }


  var terminate_worker_1  = function()
  {
        if(typeof(Worker) !== "undefined") {
          if(typeof(worker_1) != "undefined") {
              worker_1.terminate();
          }
        }
        document.getElementById('w1_status').textContent='Finished';



  }

    var terminate_worker_2  = function()
      {

        if(typeof(Worker) !== "undefined") {
          if(typeof(worker_2) != "undefined") {
              worker_2.terminate();
          }
        }
        document.getElementById('w2_status').textContent='Finished';



      }


  var setup_worker_2 = function()
  {

        if(typeof(Worker) !== "undefined") {
          if(typeof(worker_2) == "undefined") {

              worker_2 = new Worker('js/F15Worker.js');

          }
        }
    worker_2.uuid = generateUUID();
    worker_2.count=0;
    worker_2.addEventListener('message', function(e) {
          if (e.data.status !== undefined)
    {


      switch(e.data.status) {
        case 'created':
          document.getElementById('w2_status').textContent='Created';
          break;
        case 'starting':
          document.getElementById('w2_status').textContent='Starting';
          break;
        
        case 'working':
            document.getElementById('w2_status').textContent='Working';
            if (fitness_data_w2.labels.length > 10)
            {
                fitness_chart_w2.removeData( );
            }

            fitness_chart_w2.addData([e.data.fitness*-1],e.data.generation_count);
            fitness_chart_w2.update();


            for (i = 0; i < e.data.best.length; i++) {
                chromosome_chart_w2.datasets[0].points[i].value = e.data.best[i]* -1;
            }


            chromosome_chart_w2.update();

            document.getElementById('w2_gen').textContent=e.data.generation_count.toString();
            document.getElementById('w2_best').textContent=e.data.fitness*-1;
            document.getElementById('ips').textContent= e.data.ips +' User(s) Collaborating';
            break;
      case 'finished':

            if  (worker_2.count == 0) {
                for (var i = 0; i < e.data.best.length; i++) {
                    chromosome_chart_w2.datasets[0].bars[i].value = e.data.best[i];

                }
                chromosome_chart_w2.update();
                document.getElementById('w2_gen').textContent = e.data.generation_count.toString();
                document.getElementById('w2_best').textContent = e.data.fitness;
                fitness_chart_w2.addData([e.data.fitness], e.data.generation_count);
                fitness_chart_w2.update();

                document.getElementById('w2_status').textContent = 'Finished';
                document.getElementById('w2_finished').textContent = parseInt(document.getElementById('w2_finished').textContent) + 1;

                setTimeout(setup_worker_2, 20000);
                console.log('finished'+ worker_2.count++);

            }

        case 'no_work':
            //document.getElementById('w2_status').textContent='no work';
            //document.getElementById('w2_finished').textContent = parseInt(document.getElementById('w2_finished').textContent)+1 ;
            //setTimeout(setup_worker_2, 20000);
            //break;
        default:
      }

  

    }
  }, false);

  set_population(config);
  config.worker_uuid = worker_2.uuid;
  document.getElementById('w2_pop').textContent=config.population_size;

  worker_2.postMessage({'cmd': 'start', 'config': config });
  worker_2.postMessage({'cmd': 'evolve'});

     
  }

  var setup_worker_1 = function() {


      if(typeof(Worker) !== "undefined") {
          if(typeof(worker_1) == "undefined") {
              worker_1 = new Worker('js/F15Worker.js');

          }
        }
      worker_1.count=0;
      worker_1.uuid = generateUUID();
       worker_1.addEventListener('message', function(e) {

    if (e.data.status !== undefined)
    {


      switch(e.data.status) {
        case 'created':
          document.getElementById('w1_status').textContent='Created';
          break;
        case 'starting':
          document.getElementById('w1_status').textContent='Starting';
          break;

        case 'working':
          document.getElementById('w1_status').textContent='Working';
          if (fitness_data_w1.labels.length > 10)
          {
            fitness_chart_w1.removeData( );
          }

          fitness_chart_w1.addData([e.data.fitness*-1],e.data.generation_count);
          fitness_chart_w1.update();

          //chromosome_chart_w1.addData(e.data.best.slice(0,1),"");



          for (i = 0; i < e.data.best.length; i++) {
              chromosome_chart_w1.datasets[0].points[i].value = e.data.best[i]*-1;
          }


          chromosome_chart_w1.update();

          document.getElementById('w1_gen').textContent=e.data.generation_count.toString();
          document.getElementById('w1_best').textContent=e.data.fitness*-1;
          document.getElementById('ips').textContent= e.data.ips +' User(s) Collaborating';
          break;

        case 'finished':

            if  (worker_1.count == 0) {
            for (var i=0; i<e.data.best.length; i++)
              {
              chromosome_chart_w1.datasets[0].bars[i].value =e.data.best[i];

              }
              chromosome_chart_w1.update();
              document.getElementById('w1_gen').textContent=e.data.generation_count.toString();
              document.getElementById('w1_best').textContent=e.data.fitness;
              fitness_chart_w1.addData([e.data.fitness],e.data.generation_count);
              fitness_chart_w1.update();
              document.getElementById('w1_status').textContent='Finished';
              document.getElementById('w1_finished').textContent = parseInt(document.getElementById('w1_finished').textContent)+1 ;
              setTimeout(setup_worker_1, 20000);
              console.log('finished'+ worker_1.count++);

            }

            break;
        case 'no_work':
            document.getElementById('w1_status').textContent='no_work';
            //document.getElementById('w1_finished').textContent = parseInt(document.getElementById('w1_finished').textContent)+1 ;
            //setTimeout(setup_worker_1, 20000);

            break;
        default:
         }

    }

  }, false);

  set_population(config);
  config.worker_uuid = worker_1.uuid;
  document.getElementById('w1_pop').textContent=config.population_size;


  worker_1.postMessage({'cmd': 'start', 'config': config});
  worker_1.postMessage({'cmd': 'evolve'});





  }

  function generateUUID(){
      var d = new Date().getTime();
      var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = (d + Math.random()*16)%16 | 0;
          d = Math.floor(d/16);
          return (c=='x' ? r : (r&0x3|0x8)).toString(16);
      });
      return uuid;
  };

  </script>





  </body>
</html>